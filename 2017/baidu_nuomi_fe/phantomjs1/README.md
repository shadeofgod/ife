下载后可以直接命令行`phantomjs task.js`运行（当然先得装好了phantomjs）。

官方文档：[http://phantomjs.org/quick-start.html](http://phantomjs.org/quick-start.html)
另外阮一峰老师也参考官方文档写了个教程：[http://javascript.ruanyifeng.com/tool/phantomjs.html](http://javascript.ruanyifeng.com/tool/phantomjs.html)

mac可以直接使用npm安装，建议使用淘宝镜像cnpm，速度飞快，官方文档上那个下载不用vpn根本下不动。

搞清楚phantomjs是个什么东西，能拿来干什么以后（我确实以前只是听过这个名字，从没用过，研究了下似乎和爬虫差不多的原理），我们就可以研究任务需求了。

目标： 实现根据传入的参数（关键字），抓取百度第一页对应该关键字的搜索结果。并按照特定格式保存。

思路：模拟http请求，向baidu发送get或者post方式请求，然后利用open方法打开，打开后参考includejs方法注入jquery脚本方便直接查找DOM，查看baidu搜索结果页的html结构就可以找到我们需要的结果。最后保存为json格式。

注意点：

1. open方法是异步的，因此exit()必须放进回调函数内，如果在外部的话就会直接退出了。同样的，open方法的回调函数内部如果还有回调函数也必须要把exit()放入最内部，否则会过早跳出。这个坑了我好久。。
2. 其实这就相当于一个看不见的浏览器，不过你要想看见的话可以用render方法保存截图，这样也可以看看自己有没有出错。
3. 因为baidu搜索的结果都是动态生成的，所以不能直接当成静态页面去打开获取信息，需要等待异步数据返回，所以可以在open方法的回调函数内设置一个延时器，等待几秒后就能获取的页面了。(当然这是最无脑的做法)
4. 修正第三点，看了一遍文档发现可以设置一个page.loadingProgress的判断，100的时候就是载入完成了，不需要设置一个延时器，效率可以大大提高。
5. 一开始爬取动态页面的时候考虑了很久如何获取title和重定向后的完整链接，本来想着是点击进去每个结果获取页面的url和title再返回搜索结果页，不断重复这一步骤，这个过程中发现了一个坑就是全局变量需要作为evaluate的第二个参数传进去才可以在evalu内部使用，过了这个坑以后发现有个问题就是如果某个结果页很卡或者无法打开就会一直卡在那里，虽然可以增加一个判断，但是这个方法还是速度太慢，被我放弃了。
6. 还是直接爬结果页的话就很简单了，title就是直接用jq获取result div内的h3中的文本，但是url就没办法获取完整的重定向后的url了，这个问题一直没想出来怎么解决，希望有大神指点一下。